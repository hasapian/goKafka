name: GitHub Actions Kafka Multiple Brokers
on: [push]
jobs:
  Kafka-Multiple-Brokers:
    runs-on: ubuntu-latest
    steps:          
      - name: Check out repository code
        uses: actions/checkout@v3
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."             
      - name: List containers
        run: docker ps -a
      - name: Docker compose up
        run: docker-compose -f zk-single-kafka-multiple.yml up -d
      - name: Wait 10 seconds for containers
        run: sleep 10s
      - name: Check if containers are up
        run: docker ps
      - name: Create a topic 
        run: docker exec -it kafka1 kafka-topics --bootstrap-server localhost:9092 --topic events --create --partitions 3 --replication-factor 3
      - name: List topics
        run: docker exec -it kafka1 kafka-topics --bootstrap-server localhost:9092 --list
      - name: Describe the topic
        run: docker exec -it kafka1 kafka-topics --bootstrap-server localhost:9092 --describe --topic events
      - name: Check go version
        run: go version      
      - name: Run test
        run: go test -v -run TestMultiple      
      - run: echo "üçè This job's status is ${{ job.status }}."
